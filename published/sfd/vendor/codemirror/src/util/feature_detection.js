import{elt,range,removeChildren,removeChildrenAndAdd}from"./dom.js";import{ie,ie_version}from"./browser.js";export let dragAndDrop=function(){if(ie&&ie_version<9)return!1;let e=elt("div");return"draggable"in e||"dragDrop"in e}();let zwspSupported,badBidiRects;export function zeroWidthElement(e){if(null==zwspSupported){let t=elt("span","​");removeChildrenAndAdd(e,elt("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(zwspSupported=t.offsetWidth<=1&&t.offsetHeight>2&&!(ie&&ie_version<8))}let t=zwspSupported?elt("span","​"):elt("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return t.setAttribute("cm-text",""),t}export function hasBadBidiRects(e){if(null!=badBidiRects)return badBidiRects;let t=removeChildrenAndAdd(e,document.createTextNode("AخA")),n=range(t,0,1).getBoundingClientRect(),r=range(t,1,2).getBoundingClientRect();return removeChildren(e),!(!n||n.left==n.right)&&(badBidiRects=r.right-n.right<3)}export let splitLinesAuto=3!="\n\nb".split(/\n/).length?e=>{let t=0,n=[],r=e.length;for(;t<=r;){let r=e.indexOf("\n",t);-1==r&&(r=e.length);let i=e.slice(t,"\r"==e.charAt(r-1)?r-1:r),o=i.indexOf("\r");-1!=o?(n.push(i.slice(0,o)),t+=o+1):(n.push(i),t=r+1)}return n}:e=>e.split(/\r\n?|\n/);export let hasSelection=window.getSelection?e=>{try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:e=>{let t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)};export let hasCopyEvent=(()=>{let e=elt("div");return"oncopy"in e||(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)})();let badZoomedRects=null;export function hasBadZoomedRects(e){if(null!=badZoomedRects)return badZoomedRects;let t=removeChildrenAndAdd(e,elt("span","x")),n=t.getBoundingClientRect(),r=range(t,0,1).getBoundingClientRect();return badZoomedRects=Math.abs(n.left-r.left)>1}