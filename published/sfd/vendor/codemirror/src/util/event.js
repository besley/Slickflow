import{mac}from"./browser.js";import{indexOf}from"./misc.js";const noHandlers=[];export let on=function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else if(e.attachEvent)e.attachEvent("on"+t,n);else{let r=e._handlers||(e._handlers={});r[t]=(r[t]||noHandlers).concat(n)}};export function getHandlers(e,t){return e._handlers&&e._handlers[t]||noHandlers}export function off(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else if(e.detachEvent)e.detachEvent("on"+t,n);else{let r=e._handlers,o=r&&r[t];if(o){let e=indexOf(o,n);e>-1&&(r[t]=o.slice(0,e).concat(o.slice(e+1)))}}}export function signal(e,t){let n=getHandlers(e,t);if(!n.length)return;let r=Array.prototype.slice.call(arguments,2);for(let e=0;e<n.length;++e)n[e].apply(null,r)}export function signalDOMEvent(e,t,n){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),signal(e,n||t.type,e,t),e_defaultPrevented(t)||t.codemirrorIgnore}export function signalCursorActivity(e){let t=e._handlers&&e._handlers.cursorActivity;if(!t)return;let n=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]);for(let e=0;e<t.length;++e)-1==indexOf(n,t[e])&&n.push(t[e])}export function hasHandler(e,t){return getHandlers(e,t).length>0}export function eventMixin(e){e.prototype.on=function(e,t){on(this,e,t)},e.prototype.off=function(e,t){off(this,e,t)}}export function e_preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=!1}export function e_stopPropagation(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}export function e_defaultPrevented(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}export function e_stop(e){e_preventDefault(e),e_stopPropagation(e)}export function e_target(e){return e.target||e.srcElement}export function e_button(e){let t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),mac&&e.ctrlKey&&1==t&&(t=3),t}