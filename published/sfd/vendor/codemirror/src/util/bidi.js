import{lst}from"./misc.js";export function iterateBidiSections(r,t,L,e){if(!r)return e(t,L,"ltr",0);let l=!1;for(let m=0;m<r.length;++m){let b=r[m];(b.from<L&&b.to>t||t==L&&b.to==t)&&(e(Math.max(b.from,t),Math.min(b.to,L),1==b.level?"rtl":"ltr",m),l=!0)}l||e(t,L,"ltr")}export let bidiOther=null;export function getBidiPartAt(r,t,L){let e;bidiOther=null;for(let l=0;l<r.length;++l){let m=r[l];if(m.from<t&&m.to>t)return l;m.to==t&&(m.from!=m.to&&"before"==L?e=l:bidiOther=l),m.from==t&&(m.from!=m.to&&"before"!=L?e=l:bidiOther=l)}return null!=e?e:bidiOther}let bidiOrdering=function(){let r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,t=/[stwN]/,L=/[LRr]/,e=/[Lb1n]/,l=/[1n]/;function m(r,t,L){this.level=r,this.from=t,this.to=L}return function(b,n){let N="ltr"==n?"L":"R";if(0==b.length||"ltr"==n&&!r.test(b))return!1;let o=b.length,f=[];for(let r=0;r<o;++r)f.push((i=b.charCodeAt(r))<=247?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(i):1424<=i&&i<=1524?"R":1536<=i&&i<=1785?"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(i-1536):1774<=i&&i<=2220?"r":8192<=i&&i<=8203?"w":8204==i?"b":"L");var i;for(let r=0,t=N;r<o;++r){let L=f[r];"m"==L?f[r]=t:t=L}for(let r=0,t=N;r<o;++r){let e=f[r];"1"==e&&"r"==t?f[r]="n":L.test(e)&&(t=e,"r"==e&&(f[r]="R"))}for(let r=1,t=f[0];r<o-1;++r){let L=f[r];"+"==L&&"1"==t&&"1"==f[r+1]?f[r]="1":","!=L||t!=f[r+1]||"1"!=t&&"n"!=t||(f[r]=t),t=L}for(let r=0;r<o;++r){let t=f[r];if(","==t)f[r]="N";else if("%"==t){let t;for(t=r+1;t<o&&"%"==f[t];++t);let L=r&&"!"==f[r-1]||t<o&&"1"==f[t]?"1":"N";for(let e=r;e<t;++e)f[e]=L;r=t-1}}for(let r=0,t=N;r<o;++r){let e=f[r];"L"==t&&"1"==e?f[r]="L":L.test(e)&&(t=e)}for(let r=0;r<o;++r)if(t.test(f[r])){let L;for(L=r+1;L<o&&t.test(f[L]);++L);let e="L"==(r?f[r-1]:N),l=e==("L"==(L<o?f[L]:N))?e?"L":"R":N;for(let t=r;t<L;++t)f[t]=l;r=L-1}let s,h=[];for(let r=0;r<o;)if(e.test(f[r])){let t=r;for(++r;r<o&&e.test(f[r]);++r);h.push(new m(0,t,r))}else{let t=r,L=h.length,e="rtl"==n?1:0;for(++r;r<o&&"L"!=f[r];++r);for(let b=t;b<r;)if(l.test(f[b])){t<b&&(h.splice(L,0,new m(1,t,b)),L+=e);let n=b;for(++b;b<r&&l.test(f[b]);++b);h.splice(L,0,new m(2,n,b)),L+=e,t=b}else++b;t<r&&h.splice(L,0,new m(1,t,r))}return"ltr"==n&&(1==h[0].level&&(s=b.match(/^\s+/))&&(h[0].from=s[0].length,h.unshift(new m(0,0,s[0].length))),1==lst(h).level&&(s=b.match(/\s+$/))&&(lst(h).to-=s[0].length,h.push(new m(0,o-s[0].length,o)))),"rtl"==n?h.reverse():h}}();export function getOrder(r,t){let L=r.order;return null==L&&(L=r.order=bidiOrdering(r.text,t)),L}