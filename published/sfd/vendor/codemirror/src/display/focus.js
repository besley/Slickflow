import{restartBlink}from"./selection.js";import{webkit}from"../util/browser.js";import{addClass,rmClass}from"../util/dom.js";import{signal}from"../util/event.js";export function ensureFocus(e){e.hasFocus()||(e.display.input.focus(),e.state.focused||onFocus(e))}export function delayBlurEvent(e){e.state.delayingBlurEvent=!0,setTimeout((()=>{e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,e.state.focused&&onBlur(e))}),100)}export function onFocus(e,t){e.state.delayingBlurEvent&&!e.state.draggingText&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(signal(e,"focus",e,t),e.state.focused=!0,addClass(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),webkit&&setTimeout((()=>e.display.input.reset(!0)),20)),e.display.input.receivedFocus()),restartBlink(e))}export function onBlur(e,t){e.state.delayingBlurEvent||(e.state.focused&&(signal(e,"blur",e,t),e.state.focused=!1,rmClass(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout((()=>{e.state.focused||(e.display.shift=!1)}),150))}