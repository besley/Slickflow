import{CodeMirror}from"./CodeMirror.js";import{activeElt}from"../util/dom.js";import{off,on}from"../util/event.js";import{copyObj}from"../util/misc.js";export function fromTextArea(e,t){if((t=t?copyObj(t):{}).value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){let o=activeElt();t.autofocus=o==e||null!=e.getAttribute("autofocus")&&o==document.body}function o(){e.value=i.getValue()}let r;if(e.form&&(on(e.form,"submit",o),!t.leaveSubmitMethodAlone)){let t=e.form;r=t.submit;try{let e=t.submit=()=>{o(),t.submit=r,t.submit(),t.submit=e}}catch(e){}}t.finishInit=i=>{i.save=o,i.getTextArea=()=>e,i.toTextArea=()=>{i.toTextArea=isNaN,o(),e.parentNode.removeChild(i.getWrapperElement()),e.style.display="",e.form&&(off(e.form,"submit",o),t.leaveSubmitMethodAlone||"function"!=typeof e.form.submit||(e.form.submit=r))}},e.style.display="none";let i=CodeMirror((t=>e.parentNode.insertBefore(t,e.nextSibling)),t);return i}